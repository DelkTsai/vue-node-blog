webpackJsonp([16],{"34KM":function(t,e){},CwkZ:function(t,e){},IcnI:function(t,e,n){"use strict";function i(t,e){var n=t.commit;n(_),n(b,e)}function o(t,e){var n=t.commit,i=e.user,o=e.loginState;n(w,o),n(y,i)}var s={};n.d(s,"isLogin",function(){return h}),n.d(s,"showSignPopup",function(){return l}),n.d(s,"signType",function(){return d}),n.d(s,"user",function(){return f}),n.d(s,"isPopState",function(){return g});var r={};n.d(r,"setSignPopup",function(){return i}),n.d(r,"saveUserInfo",function(){return o});var a,u=n("XwMK"),c=n("9rMa"),p={isLogin:document.cookie.indexOf("vue_node_blog")>-1,showSignPopup:!1,signType:"signin",user:null,isPopState:!1},h=function(t){return t.isLogin},l=function(t){return t.showSignPopup},d=function(t){return t.signType},f=function(t){return t.user},g=function(t){return t.isPopState},m=n("a3Yh"),v=n.n(m),w="SET_LOGIN_STATE",_="SET_SIGN_POPUP",b="SET_SIGN_TYPE",y="SET_USER_INFO",P=(a={},v()(a,w,function(t,e){t.isLogin=e}),v()(a,_,function(t){t.showSignPopup=!t.showSignPopup}),v()(a,b,function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signin";t.signType=e}),v()(a,y,function(t,e){t.user=e}),v()(a,"SET_POP_STATE",function(t,e){t.isPopState=e}),a);u.a.use(c.a);e.a=new c.a.Store({state:p,getters:s,mutations:P,actions:r})},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("rVsN"),o=n.n(i),s=n("XwMK"),r=n("4YfN"),a=n.n(r),u=n("9rMa"),c={name:"basePopup",props:{title:{type:String,default:""},describe:{type:String,default:""},cancel:{type:String,default:"取消"},confirm:{type:String,default:"确定"},coverClickHide:{type:Boolean,default:!0},width:{type:String,default:"70%"}},data:function(){return{state:!1}},methods:{show:function(){this.state=!0},hide:function(){this.state=!1},confirmBtn:function(){this.hide(),this.$emit("confirm")},coverClick:function(){this.coverClickHide&&this.hide(),this.$emit("coverClick")}}},p={render:function(){var t=this.$createElement,e=this._self._c||t;return e("transition",{attrs:{name:"fade"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:this.state,expression:"state"}],staticClass:"popup-wrapper",on:{click:this.coverClick}},[e("div",{staticClass:"content",style:{width:this.width},on:{click:function(t){t.stopPropagation()}}},[this._t("default",[this.title?e("h3",{staticClass:"title"},[this._v(this._s(this.title))]):this._e(),this._v(" "),this.describe?e("p",{staticClass:"describe"},[this._v(this._s(this.describe))]):this._e(),this._v(" "),e("div",{staticClass:"footer"},[e("span",{staticClass:"btn",on:{click:this.hide}},[this._v(this._s(this.cancel))]),this._v(" "),e("span",{staticClass:"btn",on:{click:this.confirmBtn}},[this._v(this._s(this.confirm))])])])],2)])])},staticRenderFns:[]},h=n("OF7X")(c,p,!1,function(t){n("hALu")},"data-v-f438767c",null).exports,l=n("hhm8"),d=n("Vc3t"),f={name:"formPopup",props:{type:{type:String,default:"signin"},state:{type:Boolean,default:!0}},data:function(){return{coverClickHide:!0,currentType:"",width:"85%",signin:{title:"登录",input:[{type:"text",placeholder:"请输入用户名",name:"name"},{type:"password",placeholder:"请输入密码",name:"password"}],submitText:"登录"},signup:{title:"注册",input:[{type:"text",placeholder:"请输入用户名",name:"name"},{type:"password",placeholder:"请输入密码",name:"password"},{type:"password",placeholder:"请再次输入密码",name:"repassword"}],submitText:"注册"},tipsinfo:""}},created:function(){this.currentType=this.type},mounted:function(){this.popup=this.$refs.popup,this.form=this.$refs.form,this.state&&this.popup.show()},methods:a()({submitChecked:function(){var t=this.form,e=Object(l.h)(t.name.value),n=Object(l.h)(t.password.value),i=void 0;return e.length<1||e.length>10?this.tipsinfo="名字请限制在 1-10 个字符":n.length<6?this.tipsinfo="密码至少 6 个字符":"signin"!==this.currentType&&(i=Object(l.h)(t.repassword.value),n!==i)?this.tipsinfo="两次输入密码不一致":(this.tipsinfo="",void this._submit(e,n,i))},_submit:function(t,e,n){var i=this;this.coverClickHide=!1,Object(d.c)(t,e,n,this.currentType).then(function(t){var e=t.data;if(i.coverClickHide=!0,e.code===l.a)if("signin"===i.currentType){var n=i.$route.query.redirect;n?(i.saveUserInfo({user:e.data,loginState:!0}),i.$router.push(n)):(i.close(),window.location.reload())}else i.currentType="signin";else e.msg&&(i.tipsinfo=e.msg)}).catch(function(t){i.coverClickHide=!0,console.log(t)})},toggleType:function(){this.currentType="signin"===this.currentType?"signup":"signin"},_githubLogin:function(){var t=this.$route.query.redirect;Object(d.a)(t)},close:function(){this.coverClickHide&&this.setSignPopup()}},Object(u.d)({setSignPopup:"SET_SIGN_POPUP"}),Object(u.b)(["saveUserInfo"])),computed:{info:function(){return"signin"===this.currentType?this.signin:this.signup}},components:{popup:h}},g={render:function(){var t=this.$createElement,e=this._self._c||t;return e("popup",{ref:"popup",attrs:{coverClickHide:this.coverClickHide,width:this.width},on:{coverClick:this.close}},[e("div",{staticClass:"wrapper"},[e("div",{staticClass:"header"},[e("h3",{staticClass:"popup-title"},[this._v(this._s(this.info.title))]),this._v(" "),e("i",{staticClass:"iconfont close-btn",on:{click:this.close}},[this._v("")])]),this._v(" "),e("form",{ref:"form",staticClass:"form"},[this._l(this.info.input,function(t){return e("input",{attrs:{type:t.type,placeholder:t.placeholder,name:t.name}})}),this._v(" "),e("span",{staticClass:"submit-btn",on:{click:this.submitChecked}},[this._v(this._s(this.info.submitText))])],2),this._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:this.tipsinfo,expression:"tipsinfo"}],staticClass:"tipsinfo"},[this._v(this._s(this.tipsinfo))]),this._v(" "),"signin"===this.currentType?e("div",{staticClass:"signup-tip"},[e("span",{staticClass:"text"},[this._v("没有账号 ?")]),this._v(" "),e("span",{staticClass:"signup-btn",on:{click:this.toggleType}},[this._v("注册")])]):e("div",{staticClass:"signin-tip"},[e("span",{staticClass:"signin-btn",on:{click:this.toggleType}},[this._v("已有账号登录")])]),this._v(" "),e("div",{staticClass:"signin-other"},[e("span",[this._v("第三方账号登录")]),this._v(" "),e("i",{staticClass:"iconfont github",on:{click:this._githubLogin}},[this._v("")])])])])},staticRenderFns:[]},m=n("OF7X")(f,g,!1,function(t){n("UdL6")},"data-v-d6bad25a",null).exports,v=n("vMJZ"),w={name:"app",computed:a()({},Object(u.c)(["isLogin","showSignPopup","signType","isPopState"])),components:{formPopup:m},created:function(){this._getUserInfo(),this.redirect()},methods:a()({redirect:function(){var t=Object(l.f)("redirect");t&&this.$router.push(decodeURIComponent(t))},shouldCheckLoigin:function(t){"true"===t.target.getAttribute("data-shouldLogin")&&!this.isLogin&&(this.setSignPopup("signin"),t.stopPropagation())},_getUserInfo:function(){var t=this;this.isLogin&&Object(v.b)().then(function(e){var n=e.data;n.code===l.a&&t.setUserInfo(n.data)}).catch(console.log)}},Object(u.d)({setUserInfo:"SET_USER_INFO",setPopState:"SET_POP_STATE"}),Object(u.b)(["setSignPopup"])),watch:{$route:function(){var t=this;this.isPopState&&setTimeout(function(){t.setPopState(!1)},0)}}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"},on:{"!click":function(e){t.shouldCheckLoigin(e)}}},[n("div",[n("router-view",{attrs:{name:"header"}}),t._v(" "),n("keep-alive",[n("router-view")],1),t._v(" "),n("router-view",{attrs:{name:"footer"}}),t._v(" "),!t.isLogin&&t.showSignPopup?n("form-popup",{attrs:{type:t.signType}}):t._e()],1)])},staticRenderFns:[]},b=n("OF7X")(w,_,!1,function(t){n("CwkZ")},null,null).exports,y=n("zO6J"),P=n("IcnI"),C=function(){return n.e(9).then(n.bind(null,"xhcK"))},S=function(){return n.e(7).then(n.bind(null,"DHxS"))},T=function(){return Promise.all([n.e(0),n.e(11)]).then(n.bind(null,"CVCl"))},L=function(){return Promise.all([n.e(0),n.e(1)]).then(n.bind(null,"20To"))},k=function(){return Promise.all([n.e(0),n.e(12)]).then(n.bind(null,"liSp"))};s.a.use(y.a),window.addEventListener("popstate",function(){P.a.commit("SET_POP_STATE",!0)});var E=new y.a({mode:"history",scrollBehavior:function(t,e,n){return n||{x:0,y:0}},routes:[{path:"/",name:"home",components:{default:function(){return Promise.all([n.e(0),n.e(6)]).then(n.bind(null,"LqM4"))},header:C,footer:S}},{path:"/post/create",name:"postCreate",components:{default:T,header:C},meta:{shouldLogin:!0}},{path:"/post/:postId/update",name:"postUpdate",components:{default:T,header:C},meta:{shouldLogin:!0}},{path:"/post/:postId",name:"postView",components:{default:L,header:C}},{path:"/post/:postId/comment/:commentId",name:"comment",components:{default:function(){return Promise.all([n.e(0),n.e(2)]).then(n.bind(null,"LMXL"))},header:C}},{path:"/category",name:"category",components:{default:function(){return Promise.all([n.e(0),n.e(14)]).then(n.bind(null,"zlCH"))},footer:S}},{path:"/category/:category",name:"categoryPost",component:function(){return Promise.all([n.e(0),n.e(5)]).then(n.bind(null,"5HEe"))}},{path:"/category/:category/post/:postId",name:"categoryPostView",components:{default:L,header:C}},{path:"/user",name:"user",components:{default:function(){return Promise.all([n.e(0),n.e(8)]).then(n.bind(null,"BWhR"))},footer:S}},{path:"/user/post",name:"userPost",component:k,meta:{shouldLogin:!0}},{path:"/user/history",name:"postHistory",component:function(){return Promise.all([n.e(0),n.e(10)]).then(n.bind(null,"YIJx"))},meta:{shouldLogin:!0}},{path:"/user/collection",name:"collection",component:function(){return Promise.all([n.e(0),n.e(3)]).then(n.bind(null,"d7P4"))},meta:{shouldLogin:!0}},{path:"/user/follow",name:"followAuthor",component:function(){return Promise.all([n.e(0),n.e(4)]).then(n.bind(null,"wWT0"))},meta:{shouldLogin:!0}},{path:"/user/followAuthor/:followAuthor",name:"followAuthorPost",component:k,meta:{shouldLogin:!0}},{path:"/user/edit",name:"edit",component:function(){return Promise.all([n.e(0),n.e(13)]).then(n.bind(null,"Z9IP"))},meta:{shouldLogin:!0}},{path:"*",redirect:"/"}]});E.beforeEach(function(t,e,n){var i=t.meta.shouldLogin,o=P.a.getters.isLogin;i&&!o?(P.a.dispatch("setSignPopup","signin"),n({path:e.fullPath,query:{redirect:t.fullPath}})):n()});var I=E;n("34KM");s.a.config.productionTip=!1,s.a.mixin({data:function(){return{intoPageCount:0}}}),o.a.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})})},new s.a({el:"#app",router:I,store:P.a,template:"<App/>",components:{App:b}})},UdL6:function(t,e){},Vc3t:function(t,e,n){"use strict";e.c=function(t,e,n){if("signin"===(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"signin")){var o={name:t,password:e};return i.a.post("signin",o)}var s={name:t,password:e,repassword:n};return i.a.post("signup",s)},e.a=function(t){var e=o.e?"http://localhost:3000/api/signin/github":"/api/signin/github";e=t?e+"?redirect="+t:e,window.location.href=e},e.b=function(){return i.a.get("signout")};var i=n("rC09"),o=n("hhm8")},hALu:function(t,e){},hhm8:function(t,e,n){"use strict";n.d(e,"e",function(){return i}),n.d(e,"a",function(){return o}),n.d(e,"i",function(){return s}),e.h=function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},e.f=function(t){var e=window.location.search.match(new RegExp(t+"=[^?&]+","g")),n=e?e[0].split("=")[1]:"";return decodeURIComponent(n)},e.g=function(t){var e=new Date(t).getTime(),n=((new Date).getTime()-e)/1e3,i=r.findIndex(function(t,e){return t<=n&&r[e+1]>n});return 0===i?a[0]:(n=n/r[i]|0)+a[i]},e.d=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in n)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[i]:("00"+n[i]).substr((""+n[i]).length)));return t},e.c=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments[2],i=void 0;return function(){for(var o=this,s=arguments.length,r=Array(s),a=0;a<s;a++)r[a]=arguments[a];clearTimeout(i),i=setTimeout(function(){n=n||o,t.apply.apply(t,[n].concat(r))},e)}},e.b=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,e=window.innerHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;return e+(document.documentElement.scrollTop||document.body.scrollTop)>=n-t};var i=!1,o=0,s=-2,r=[0,60,3600,86400,2592e3,94608e4,Number.MAX_VALUE],a=["刚刚","分钟前","小时前","天前","月前","年前"]},rC09:function(t,e,n){"use strict";var i=n("rVsN"),o=n.n(i),s=n("2sCs"),r=n.n(s),a=n("IcnI"),u=n("hhm8");u.e?(r.a.defaults.baseURL="http://localhost:3000/api",r.a.defaults.withCredentials=!0):r.a.defaults.baseURL="/api",r.a.defaults.headers.post["Content-Type"]="appliction/x-www-form-urlencoded",r.a.interceptors.response.use(function(t){return t.data.code===u.i&&a.a.getters.isLogin&&(a.a.dispatch("saveUserInfo",{user:null,loginState:!1}),a.a.dispatch("setSignPopup","signin")),t},function(t){return o.a.reject(t)}),e.a=r.a},vMJZ:function(t,e,n){"use strict";e.b=function(){return i.a.post("user/getUserInfo")},e.a=function(t){return i.a.post("user/edit",t,{headers:{"Content-Type":"appliction/x-www-form-urlencoded"}})};var i=n("rC09")}},["NHnr"]);
//# sourceMappingURL=app.57113af7bcb808b99b45.js.map